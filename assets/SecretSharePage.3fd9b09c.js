import{Q as R,P as U,a as z}from"./papaparse.min.bc6b65dc.js";import{c as L,a as O,h as V,b as T,g as J,_ as N,a3 as D,r as c,a4 as Q,K as C,a5 as q,N as n,M as u,R as H,P as i,Q as _,a8 as I,L as j,a9 as w,a6 as W,I as G,J as X}from"./index.431c2acb.js";import{Q as Y}from"./QCheckbox.9cad8a68.js";import{Q as P}from"./QInput.da986437.js";import{Q as B}from"./QCard.2098204a.js";import{Q as Z,e as $}from"./export-file.f4fadcf0.js";import{u as ee}from"./use-quasar.3178828e.js";import{r as oe}from"./routers.de2dd85d.js";import"./use-key-composition.de1f7167.js";import"./use-dark.780b0e18.js";import"./format.825448b2.js";import"./selection.e765c3e1.js";import"./QSeparator.8b567366.js";import"./QList.3e6a53f3.js";var S=L({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(a,{slots:r}){const h=J(),o=O(()=>"q-td"+(a.autoWidth===!0?" q-table--col-auto-width":"")+(a.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(a.props===void 0)return V("td",{class:o.value},T(r.default));const p=h.vnode.key,m=(a.props.colsMap!==void 0?a.props.colsMap[p]:null)||a.props.col;if(m===void 0)return;const{row:e}=a.props;return V("td",{class:o.value+m.__tdClass(e),style:m.__tdStyle(e)},T(r.default))}}});const te={setup(){const a=ee();D();const r=c(null),h=Q(),o=c(h.isAuthenticated),p=c(null),m=c(!1),e=c(!1),f=c(2),b=c(2),v=c(null),y=c(null),g=c(null),E=c([{label:"Shamir",value:"split.shamir"},{label:"PVSS",value:"split.pvss"}]);async function M(){try{const s=Q();let l=null;if(b.value?f.value?g.value?b.value>f.value&&(l="The N parameter must be greater than the K parameter"):l="Missing Algorithm parameter":l="Missing N parameter":l="Missing K parameter",l){a.notify({color:"red",textColor:"white",icon:"error",message:l});return}const d=await fetch(oe.SPLIT,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${s.token}`},body:JSON.stringify({data:JSON.stringify(p.value),execution_parameters:{algorithm:g.value.value,n:parseInt(f.value),k:parseInt(b.value)}})});if(d.ok){const t=await d.json();v.value=t.shares,v.value.forEach(function(x){x.algorithm=g.value.value}),t.modulus&&t.encrypted_text?(v.value.forEach(function(x){x.modulus=t.modulus,x.encrypted_text=t.encrypted_text}),y.value=[{name:"x",label:"x",align:"left",field:"x",sortable:!0},{name:"algorithm",label:"algorithm",field:"algorithm",sortable:!0},{name:"modulus",label:"modulus",field:"modulus",sortable:!0},{name:"encrypted_text",label:"encrypted_text",field:"encrypted_text",sortable:!0},{name:"y",label:"y",field:"y",sortable:!0}]):y.value=[{name:"x",align:"left",label:"x",field:"x",sortable:!0},{name:"algorithm",label:"algorithm",field:"algorithm",sortable:!0},{name:"y",label:"y",field:"y",sortable:!0}],e.value=!0,m.value=!1}else a.notify({color:"red",textColor:"white",icon:"error",message:"Bad Request ".concat(d.status)})}catch(s){a.notify({color:"red",textColor:"white",icon:"error",message:" ".concat(s)})}}function A(s){const l=document.createElement("textarea");l.value=s,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l)}function F(){const s=[y.value.map(d=>k(d.label))].concat(v.value.map(d=>y.value.map(t=>k(typeof t.field=="function"?t.field(d):d[t.field===void 0?t.name:t.field])).join(","))).join(`\r
`);$("doc.csv",s,"text/csv")!==!0&&a.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}function k(s,l,d){let t=l!==void 0?l(s,d):s;return t=t==null?"":String(t),t=t.split('"').join('""'),`"${t}"`}function K(){try{if(r.value){const s=r.value[0],l=new FileReader;l.onload=d=>{U.parse(d.target.result,{header:!0,complete:t=>{p.value=t.data,m.value=!0},error:t=>{a.notify({color:"red",textColor:"white",icon:"error",message:`Error parsing CSV: '${t.message}'`})}})},l.readAsText(s)}}catch(s){a.notify({color:"red",textColor:"white",icon:"error",message:`Error reading file: '${s}'`})}}return{files:r,userLoggedIn:o,fileContent:p,showTable:e,columns:y,uploadFile:K,showBtn:m,onSubmit:M,n:f,k:b,options:E,algorithm:g,rows:v,copyToClipboard:A,exportTable:F}}},le=i("div",{class:"text-h6 q-pb-md q-pl-sm"},"Secret Share",-1),ae={key:0},re=i("br",null,null,-1),ne=i("br",null,null,-1),se={align:"right"},ie={class:"row justify-end"},de={style:{overflow:"hidden","max-width":"10rem"}},ce={class:"q-ml-sm"},ue={class:"row justify-end"},me={style:{overflow:"hidden","max-width":"10rem"}},pe={class:"q-ml-sm"},fe={class:"row justify-end"},he={style:{overflow:"hidden","max-width":"10rem"}},ve={class:"q-ml-sm"};function ye(a,r,h,o,p,m){return C(),q(W,null,[n(B,{class:"q-pa-md q-ma-md"},{default:u(()=>[le,n(R,{modelValue:o.files,"onUpdate:modelValue":[r[0]||(r[0]=e=>o.files=e),o.uploadFile],label:"Drop or Select a File...",filled:"","max-files":"1",multiple:"",class:"custom-file-input",disable:!o.userLoggedIn,readonly:o.showTable,accept:".csv"},{prepend:u(()=>[n(H,{name:"attach_file",class:"file-icon"})]),_:1},8,["modelValue","disable","readonly","onUpdate:modelValue"]),o.showBtn?(C(),q("div",ae,[re,n(Y,{filled:"",modelValue:o.algorithm,"onUpdate:modelValue":r[1]||(r[1]=e=>o.algorithm=e),options:o.options,label:"Algorithm"},null,8,["modelValue","options"]),ne,n(P,{filled:"",modelValue:o.n,"onUpdate:modelValue":r[2]||(r[2]=e=>o.n=e),type:"number",label:"Share Number (N)",rules:[e=>o.algorithm.value==="split.pvss"?parseInt(e)>=3||"Please use at least 3 shares":parseInt(e)>=2||"Please use at least 2 shares"]},null,8,["modelValue","rules"]),n(P,{filled:"",modelValue:o.k,"onUpdate:modelValue":r[3]||(r[3]=e=>o.k=e),type:"number",label:"Keys Number (K)",rules:[e=>parseInt(e)<=o.n||`Please use at most ${o.n} keys`]},null,8,["modelValue","rules"]),i("div",se,[n(_,{label:"Submit",color:"primary",onClick:o.onSubmit},null,8,["onClick"])])])):I("",!0)]),_:1}),o.showTable?(C(),j(B,{key:0,class:"q-pa-md q-ma-md"},{default:u(()=>[n(Z,{flat:"",bordered:"",dense:"",title:"title",rows:o.rows,columns:o.columns,"row-key":"x"},{"top-right":u(()=>[n(_,{color:"primary","icon-right":"archive",label:"Export to CSV","no-caps":"",onClick:o.exportTable},null,8,["onClick"])]),"body-cell-y":u(e=>[n(S,{props:e},{default:u(()=>[i("div",ie,[i("div",de,w(e.value),1),i("div",ce,[n(_,{padding:"none",size:"10px",flat:"",color:"primary",icon:"content_copy",onClick:f=>o.copyToClipboard(e.value)},null,8,["onClick"])])])]),_:2},1032,["props"])]),"body-cell-modulus":u(e=>[n(S,{props:e},{default:u(()=>[i("div",ue,[i("div",me,w(e.value),1),i("div",pe,[n(_,{padding:"none",size:"10px",flat:"",color:"primary",icon:"content_copy",onClick:f=>o.copyToClipboard(e.value)},null,8,["onClick"])])])]),_:2},1032,["props"])]),"body-cell-encrypted_text":u(e=>[n(S,{props:e},{default:u(()=>[i("div",fe,[i("div",he,w(e.value),1),i("div",ve,[n(_,{padding:"none",size:"10px",flat:"",color:"primary",icon:"content_copy",onClick:f=>o.copyToClipboard(e.value)},null,8,["onClick"])])])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})):I("",!0)],64)}var _e=N(te,[["render",ye]]);const be=G({name:"IndexPage",components:{SecretShare:_e}});function ge(a,r,h,o,p,m){const e=X("SecretShare");return C(),j(z,null,{default:u(()=>[n(e)]),_:1})}var Ee=N(be,[["render",ge]]);export{Ee as default};
